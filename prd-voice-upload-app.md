# Voice Upload & Project Intelligence Web App — PRD (MVP)

## Executive Summary

A mobile-responsive web app for uploading, transcribing, and organizing voice recordings into structured projects. The user uploads an audio file (max 25MB), which triggers an n8n webhook that handles the entire processing pipeline — Whisper transcription, Ollama summarization, and storage to n8n Tables. The web app is purely frontend: it fires a webhook, polls for status, and renders the results. Audio is discarded after transcription. Projects accumulate a living transcript and an AI-updated summary as new recordings are added. Single-user, no auth, no chat, no VectorStore.

---

## Overview

| Field | Value |
|---|---|
| Platform | Web (mobile-responsive) |
| Input Method | Audio file upload |
| Transcription | Whisper API (via n8n) |
| AI Processing | Self-hosted Ollama on VPS (via n8n) |
| Orchestration | Self-hosted n8n |
| Storage | n8n Tables — transcripts and summaries only |
| Auth | None — single user |
| File Limit | 25MB per upload |
| Core Concept | Project-scoped recordings with auto-generated transcripts and summaries |
| Deferred | Native app, in-app recording, chat interface, VectorStore |

---

## Architecture

```
Web App (Next.js)
    │
    ├── POST audio + project_id → n8n Webhook
    │       │
    │       ├── Validate file
    │       ├── Submit to Whisper API → raw transcript
    │       ├── Discard audio
    │       ├── Send transcript to Ollama → recording summary
    │       ├── If first recording: send summary to Ollama → project title
    │       ├── Append transcript to project_transcript (n8n Tables)
    │       ├── Send project_transcript + existing summary to Ollama → updated project summary
    │       └── Write all results to n8n Tables
    │
    └── GET /api/status/:job_id → poll for completion
        GET /api/projects → read from n8n Tables
        GET /api/projects/:id → read from n8n Tables
        GET /api/projects/:id/recordings → read from n8n Tables
        GET /api/projects/:id/recordings/:id → read from n8n Tables
```

The web app has no direct connection to Whisper or Ollama. All business logic lives in n8n workflows.

---

## Data Model (n8n Tables)

### Projects Table

| Field | Type | Description |
|---|---|---|
| `project_id` | String | Auto-generated UUID |
| `title` | String | Seeded from first recording summary via Ollama, manually editable + lockable |
| `title_locked` | Boolean | True after first manual edit — disables auto-seeding |
| `description` | String | User-defined |
| `project_transcript` | Text | Append-only concatenation of all recording transcripts |
| `project_summary` | Text | Regenerated by Ollama after each new recording |
| `recording_count` | Number | Incremented on each new recording |
| `created_at` | Timestamp | |
| `updated_at` | Timestamp | |

### Recordings Table

| Field | Type | Description |
|---|---|---|
| `recording_id` | String | Auto-generated UUID |
| `project_id` | String | Foreign key → Projects |
| `raw_transcript` | Text | From Whisper |
| `summary` | Text | Generated by Ollama |
| `status` | String | `processing` / `done` / `error` |
| `created_at` | Timestamp | |

> **Note:** No audio stored. Audio is discarded by n8n after successful Whisper response.

---

## n8n Workflows

### WORKFLOW-001 — Upload & Process Recording
**Trigger:** Webhook (POST) — receives audio file + optional `project_id`

Steps:
1. Validate file type and size (≤ 25MB)
2. If no `project_id` → create new project row in n8n Tables
3. Submit audio to Whisper API
4. On success: discard audio, store `raw_transcript` on recording row
5. Send `raw_transcript` to Ollama → store `summary` on recording row
6. If `recording_count` on project is 0 and `title_locked` is false → send summary to Ollama → generate title → store on project
7. Fetch existing `project_transcript`, append new transcript, store back
8. Send full `project_transcript` + existing `project_summary` to Ollama → store updated `project_summary`
9. Set recording `status` to `done`, increment project `recording_count`
10. Return `recording_id` and `project_id` to web app

### WORKFLOW-002 — Get Projects
**Trigger:** Webhook (GET) — returns all projects ordered by `updated_at` desc

### WORKFLOW-003 — Get Project Detail
**Trigger:** Webhook (GET `:project_id`) — returns project row including `project_summary` and `project_transcript`

### WORKFLOW-004 — Get Recordings List
**Trigger:** Webhook (GET `:project_id/recordings`) — returns all recordings for project, ordered by `created_at` desc

### WORKFLOW-005 — Get Recording Detail
**Trigger:** Webhook (GET `:project_id/recordings/:recording_id`) — returns single recording row

### WORKFLOW-006 — Update Project Metadata
**Trigger:** Webhook (PATCH `:project_id`) — updates `title`, `title_locked`, or `description`

---

## Core Logic — Upload & Processing Flow

1. User initiates upload from Home or Project Detail
2. Client-side validation: accepted format + under 25MB — reject immediately if not
3. POST audio + optional `project_id` to n8n webhook (WORKFLOW-001)
4. n8n: if no `project_id` → auto-create project row, return new `project_id`
5. n8n: submit audio to Whisper → receive raw transcript
6. n8n: **discard audio**
7. n8n: store raw transcript on recording row, set status `processing`
8. n8n: send transcript to Ollama → generate recording summary, store on recording
9. n8n: if first recording in project + title not locked → generate title via Ollama, store on project
10. n8n: append transcript to `project_transcript`
11. n8n: send `project_transcript` + `project_summary` to Ollama → update `project_summary`
12. n8n: set recording status to `done`
13. Web app: polling detects `done` → dismiss upload sheet, navigate to project/recording

---

## Tasks

### TASK-001 — n8n: Upload & Process Workflow (WORKFLOW-001)
- Webhook endpoint accepting multipart audio + project_id
- File validation inside workflow as safety net
- Whisper API call + response handling
- Audio discard after successful transcription
- Ollama calls for recording summary and project title (if first recording)
- Project transcript append logic
- Project summary regeneration
- Status updates on recording row throughout

### TASK-002 — n8n: Read Endpoints (WORKFLOWS 002–005)
- Webhook GET endpoints for all read operations
- Return structured JSON consumed directly by the web app
- Filtering and sorting handled inside n8n

### TASK-003 — n8n: Update Project Metadata (WORKFLOW-006)
- PATCH endpoint for title, title_locked, description
- Respect `title_locked` flag — lock on first manual edit

### TASK-004 — Web App: Upload Flow
- Client-side file validation (format + 25MB)
- POST to WORKFLOW-001 with audio + project_id if available
- Receive job identifiers, begin polling for status
- Surface progress states in upload sheet UI
- On completion: auto-dismiss sheet, navigate to project or recording

### TASK-005 — Web App: Polling / Status
- Poll recording status endpoint every 2–3 seconds after upload
- Update UI: Uploading → Transcribing → Generating Summary → Done
- On error status: surface retry option
- Stop polling on `done` or `error`

### TASK-006 — Web App: Project List View
- Fetch from WORKFLOW-002 on load
- Empty state: Upload CTA
- Populated state: project cards + FAB

### TASK-007 — Web App: Project Detail View
- Fetch from WORKFLOW-003 on load
- Editable title (PATCH via WORKFLOW-006), locks on first manual edit
- Editable description (PATCH via WORKFLOW-006)
- Summary / Transcript tabs with search
- Processing banner if any recording in project has status `processing`
- Upload button (center bottom nav)
- Recordings nav (left bottom nav)

### TASK-008 — Web App: Recordings List View
- Fetch from WORKFLOW-004 on load
- Read-only chronological list
- Tap → Recording Detail
- No upload entry point

### TASK-009 — Web App: Recording Detail View
- Fetch from WORKFLOW-005 on load
- Read-only Summary / Transcript tabs with search
- If status is `processing`: show inline processing state instead of content

### TASK-010 — Search
- Text-based, inline highlight
- Scoped to active tab content only
- Available on: Project Detail (both tabs), Recording Detail (both tabs)
- Client-side only — searches rendered text, no server call

### TASK-011 — File Validation
- Client-side, before any network request
- Accepted: mp3, m4a, wav, webm, ogg
- Max: 25MB
- Inline error in upload sheet, no server round-trip

---

## Pages, Routes & UI

---

### PAGE-001 — Home / Project List

**Route:** `/`

**Purpose:** Entry point. Shows all projects or prompts first upload.

#### UI — Empty State
- Full-height centered layout
- App name / logo at top
- Large upload icon + primary CTA: **"Upload Recording"**
- Subtext: "Upload an audio file to create your first project"

#### UI — Populated State
- Sticky top bar: app name/logo left
- Scrollable list of project cards, newest first
  - Each card: project title, last updated date, recording count ("4 recordings")
  - Full card tappable → `/projects/:project_id`
- FAB bottom-right: upload icon — triggers upload sheet, auto-creates project via n8n

#### Mobile Considerations
- Full-width cards, min 64px tap height
- FAB fixed above bottom safe area
- No horizontal scroll

---

### PAGE-002 — Project Detail

**Route:** `/projects/:project_id`

**Purpose:** Core project view — metadata, summary, transcript, upload entry.

#### UI
- Top bar: back arrow (left), project title center (tappable to edit if unlocked), lock icon right
- Project description below header — tap to edit inline, grey placeholder if empty
- Tab bar: **Summary** | **Transcript** (swipeable)
- Search bar below tabs — persistent, searches active tab, highlights inline, clear button
- Scrollable content area:
  - **Summary tab:** `project_summary`. Skeleton if processing.
  - **Transcript tab:** full `project_transcript`. Readable body font.
- Processing banner (sticky below top bar if active): "Processing new recording…"
- Fixed bottom nav bar:
  - Left: Recordings icon → `/projects/:project_id/recordings`
  - Center: Upload button (elevated FAB-style) → upload sheet scoped to project
  - Right: Reserved / empty

#### Mobile Considerations
- Title editing is inline, not a modal
- Description collapses to one line with expand tap if long
- Bottom nav above device safe area

---

### PAGE-003 — Recordings List

**Route:** `/projects/:project_id/recordings`

**Purpose:** Chronological browse of all recordings in a project. Read-only.

#### UI
- Top bar: back arrow → Project Detail, title: "Recordings"
- Scrollable list, newest to oldest:
  - Each row: date/time left, transcript preview center (2 lines, truncated), status badge if processing
  - Full row tappable → `/projects/:project_id/recordings/:recording_id`
  - Row dividers
- Empty state: "No recordings yet. Upload one from the project page."
- No upload button here

#### Mobile Considerations
- Min row height 72px
- Transcript preview truncated with ellipsis
- Pull-to-refresh to re-fetch from n8n

---

### PAGE-004 — Recording Detail

**Route:** `/projects/:project_id/recordings/:recording_id`

**Purpose:** Read-only view of a single recording's summary and transcript.

#### UI
- Top bar: back arrow → Recordings List, title: recording date/time (e.g. "Feb 28, 2:14 PM")
- Tab bar: **Summary** | **Transcript** (swipeable)
- Search bar below tabs — same pattern as Project Detail
- Scrollable content area:
  - **Summary tab:** recording `summary`. Spinner if status is `processing`.
  - **Transcript tab:** `raw_transcript`. Readable body font.
- If status is `processing`: replace content with "Transcribing your recording…"
- No bottom nav, no upload — back arrow only exit

#### Mobile Considerations
- Consistent tab/search pattern with Project Detail
- Content fills remaining viewport height
- Long transcripts scroll smoothly, search jumps to first match

---

### PAGE-005 — Upload Sheet (Bottom Sheet / Modal)

**Route:** No dedicated route — overlay triggered from `/` or `/projects/:project_id`

**Purpose:** File selection, validation, and processing feedback.

#### UI
- Bottom sheet on mobile, centered modal on desktop
- Title: "Upload Recording"
- Drop zone / tap-to-browse:
  - Accepted formats: mp3, m4a, wav, webm, ogg
  - Max size: 25MB
- Post-selection: filename + file size + Remove option
- Validation errors inline (wrong type, over 25MB)
- CTA: **"Upload & Transcribe"**
- Cancel button
- Processing states (replace CTA area, driven by polling):
  - `Uploading…` — progress bar
  - `Transcribing…` — spinner
  - `Generating summary…` — spinner
  - `Done ✓` — auto-dismiss, navigate to project or recording detail
- Error state: message + Retry button

#### Mobile Considerations
- Respects bottom safe area
- Native file picker (no drag-drop on mobile)
- Swipe-down to dismiss only when not actively uploading

---

## Resolved Decisions

| Question | Decision |
|---|---|
| LLM for summarization | Self-hosted Ollama on VPS |
| Orchestration | Self-hosted n8n |
| Storage | n8n Tables |
| Audio storage | Discarded by n8n after successful Whisper transcription |
| Auth | None — single user |
| Max file size | 25MB |
| Project title seeding | Generated by Ollama from first recording's summary |
| Upload entry points | Home FAB + Project Detail center nav only |
| Business logic location | Entirely in n8n workflows — web app is frontend only |
